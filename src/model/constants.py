"""
Octonion Algebra Constants
--------------------------
Shared constants for Cayley-Dickson octonion multiplication.

The sign and weight index tables define how 8 input components combine
to produce 8 output components in octonion multiplication:
    y_i = sum_j (SIGN_TABLE[i,j] * x_j @ W[WEIGHT_IDX[i,j]])
"""

# Sign table for octonion multiplication (8x8)
# Row = output index (y0-y7), Col = input index (x0-x7)
SIGN_TABLE = [
    # y0 = x0@W[0] - x1@W[1] - x2@W[2] - x3@W[3] - x4@W[4] - x5@W[5] - x6@W[6] - x7@W[7]
    [+1, -1, -1, -1, -1, -1, -1, -1],  # y0
    # y1 = x0@W[1] + x1@W[0] + x2@W[3] - x3@W[2] + x4@W[5] - x5@W[4] - x6@W[7] + x7@W[6]
    [+1, +1, +1, -1, +1, -1, -1, +1],  # y1
    # y2 = x0@W[2] - x1@W[3] + x2@W[0] + x3@W[1] + x4@W[6] + x5@W[7] - x6@W[4] - x7@W[5]
    [+1, -1, +1, +1, +1, +1, -1, -1],  # y2
    # y3 = x0@W[3] + x1@W[2] - x2@W[1] + x3@W[0] + x4@W[7] - x5@W[6] + x6@W[5] - x7@W[4]
    [+1, +1, -1, +1, +1, -1, +1, -1],  # y3
    # y4 = x0@W[4] - x1@W[5] - x2@W[6] - x3@W[7] + x4@W[0] + x5@W[1] + x6@W[2] + x7@W[3]
    [+1, -1, -1, -1, +1, +1, +1, +1],  # y4
    # y5 = x0@W[5] + x1@W[4] - x2@W[7] + x3@W[6] - x4@W[1] + x5@W[0] - x6@W[3] + x7@W[2]
    [+1, +1, -1, +1, -1, +1, -1, +1],  # y5
    # y6 = x0@W[6] + x1@W[7] + x2@W[4] - x3@W[5] - x4@W[2] + x5@W[3] + x6@W[0] - x7@W[1]
    [+1, +1, +1, -1, -1, +1, +1, -1],  # y6
    # y7 = x0@W[7] - x1@W[6] + x2@W[5] + x3@W[4] - x4@W[3] - x5@W[2] + x6@W[1] + x7@W[0]
    [+1, -1, +1, +1, -1, -1, +1, +1],  # y7
]

# Weight index table - which weight matrix W[k] to use for term (i, j)
WEIGHT_IDX = [
    # y0: W[0], W[1], W[2], W[3], W[4], W[5], W[6], W[7]
    [0, 1, 2, 3, 4, 5, 6, 7],  # y0
    # y1: W[1], W[0], W[3], W[2], W[5], W[4], W[7], W[6]
    [1, 0, 3, 2, 5, 4, 7, 6],  # y1
    # y2: W[2], W[3], W[0], W[1], W[6], W[7], W[4], W[5]
    [2, 3, 0, 1, 6, 7, 4, 5],  # y2
    # y3: W[3], W[2], W[1], W[0], W[7], W[6], W[5], W[4]
    [3, 2, 1, 0, 7, 6, 5, 4],  # y3
    # y4: W[4], W[5], W[6], W[7], W[0], W[1], W[2], W[3]
    [4, 5, 6, 7, 0, 1, 2, 3],  # y4
    # y5: W[5], W[4], W[7], W[6], W[1], W[0], W[3], W[2]
    [5, 4, 7, 6, 1, 0, 3, 2],  # y5
    # y6: W[6], W[7], W[4], W[5], W[2], W[3], W[0], W[1]
    [6, 7, 4, 5, 2, 3, 0, 1],  # y6
    # y7: W[7], W[6], W[5], W[4], W[3], W[2], W[1], W[0]
    [7, 6, 5, 4, 3, 2, 1, 0],  # y7
]

# Backward pass tables for gradient computation
# Sign table for dx backward pass
SIGN_TABLE_DX = [
    [-1, +1, +1, +1, +1, +1, +1, +1],
    [-1, +1, +1, -1, -1, +1, +1, -1],
    [-1, -1, +1, +1, -1, -1, +1, +1],
    [-1, +1, -1, +1, -1, +1, -1, +1],
    [-1, -1, -1, -1, +1, +1, +1, +1],
    [-1, +1, +1, -1, +1, -1, -1, +1],
    [-1, -1, +1, +1, +1, +1, -1, -1],
    [-1, +1, -1, -1, +1, -1, +1, +1],
]

# Weight index table for dx backward pass
WIDX_TABLE_DX = [
    [0, 1, 2, 3, 4, 5, 6, 7],
    [1, 0, 3, 2, 5, 4, 7, 6],
    [2, 3, 0, 1, 6, 7, 4, 5],
    [3, 2, 1, 0, 7, 6, 5, 4],
    [4, 5, 6, 7, 0, 1, 2, 3],
    [5, 4, 7, 6, 1, 0, 3, 2],
    [6, 7, 4, 5, 2, 3, 0, 1],
    [7, 6, 5, 4, 3, 2, 1, 0],
]

# dW backward: input index j for computing dW[k]
DT_J = [
    [0, 1, 2, 3, 4, 5, 6, 7],
    [1, 0, 3, 2, 5, 4, 7, 6],
    [2, 3, 0, 1, 6, 7, 4, 5],
    [3, 2, 1, 0, 7, 6, 5, 4],
    [4, 5, 6, 7, 0, 1, 2, 3],
    [5, 4, 7, 6, 1, 0, 3, 2],
    [6, 7, 4, 5, 2, 3, 0, 1],
    [7, 6, 5, 4, 3, 2, 1, 0],
]

# dW backward: sign for computing dW[k]
DT_S = [
    [+1, +1, +1, +1, +1, +1, +1, +1],
    [-1, +1, -1, +1, -1, +1, +1, -1],
    [-1, +1, +1, -1, -1, +1, +1, -1],
    [-1, -1, +1, +1, -1, -1, +1, +1],
    [-1, +1, +1, +1, +1, -1, -1, -1],
    [-1, -1, +1, -1, +1, +1, +1, -1],
    [-1, -1, -1, +1, +1, -1, +1, +1],
    [-1, +1, -1, -1, +1, +1, -1, +1],
]
